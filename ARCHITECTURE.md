# ğŸ—ï¸ BN Alpha Tool æ¶æ„æ–‡æ¡£ v5.0 (Webç®¡ç†ç•Œé¢ç‰ˆ)

## ğŸ“‹ æ¶æ„æ¦‚è§ˆ

BN Alpha Tool æ˜¯ä¸€ä¸ªåŸºäº **Next.js 14**ã€**Supabase** å’Œ **Webç®¡ç†ç•Œé¢** æ„å»ºçš„ç®€æ´é«˜æ•ˆçš„åŒºå—é“¾æ•°æ®åˆ†æå·¥å…·ï¼Œä¸“æ³¨äº**æ•°æ®å±•ç¤ºåˆ†æ**å’Œ**ä¾¿æ·æ•°æ®ç®¡ç†**ã€‚

### ğŸ¯ æ ¸å¿ƒä»·å€¼

- **ğŸ“Š ä¸“æ³¨æ•°æ®å±•ç¤º**: å‰ç«¯ä¸“æ³¨äºæ•°æ®å¯è§†åŒ–å’Œç”¨æˆ·ä½“éªŒ
- **ğŸ› ï¸ ä¾¿æ·ç®¡ç†**: å†…ç½®Webç®¡ç†ç•Œé¢ï¼Œéšæ—¶éšåœ°ç®¡ç†æ•°æ®
- **âš¡ æ¶æ„ç®€æ´**: ç»Ÿä¸€çš„APIæ¶æ„ï¼Œæœ€å°åŒ–ä»£ç å¤æ‚åº¦
- **ğŸ›¡ï¸ ç±»å‹å®‰å…¨**: å…¨æ ˆ TypeScript + Prisma ç±»å‹ç”Ÿæˆ + æ•°æ®éªŒè¯
- **ğŸ”§ å¼€ç®±å³ç”¨**: æ— éœ€å¤æ‚é…ç½®ï¼Œä¸“æ³¨æ ¸å¿ƒåŠŸèƒ½

## ğŸ“ é¡¹ç›®ç›®å½•ç»“æ„

```
bn-alpha-tool/
â”œâ”€â”€ app/                          # Next.js 14 App Router
â”‚   â”œâ”€â”€ api/                     # æœåŠ¡ç«¯APIè·¯ç”±
â”‚   â”‚   â”œâ”€â”€ airdrop/             # ç©ºæŠ•æ•°æ®åªè¯»API
â”‚   â”‚   â”‚   â””â”€â”€ route.ts         # GET è·å–æ‰€æœ‰ç©ºæŠ•æ•°æ®
â”‚   â”‚   â”œâ”€â”€ admin/               # ç®¡ç†å‘˜API
â”‚   â”‚   â”‚   â””â”€â”€ airdrop/         # ç©ºæŠ•æ•°æ®ç®¡ç†API (CRUD)
â”‚   â”‚   â”œâ”€â”€ revenue/analyze/     # æ”¶ç›Šåˆ†æAPI
â”‚   â”‚   â”œâ”€â”€ export-data/         # æ•°æ®å¯¼å‡ºAPI
â”‚   â”‚   â””â”€â”€ save-log/            # æ—¥å¿—ä¿å­˜API
â”‚   â”œâ”€â”€ admin/                   # ç®¡ç†å‘˜ç•Œé¢
â”‚   â”‚   â””â”€â”€ page.tsx             # ç®¡ç†å‘˜ä¸»é¡µé¢
â”‚   â”œâ”€â”€ globals.css              # å…¨å±€æ ·å¼
â”‚   â”œâ”€â”€ layout.tsx               # æ ¹å¸ƒå±€ç»„ä»¶
â”‚   â””â”€â”€ page.tsx                 # ä¸»é¡µé¢
â”œâ”€â”€ components/                   # Reactç»„ä»¶åº“
â”‚   â”œâ”€â”€ ui/                      # åŸºç¡€UIç»„ä»¶ (shadcn/ui)
â”‚   â”œâ”€â”€ admin/                   # ç®¡ç†å‘˜ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ airdrop-form.tsx     # ç©ºæŠ•æ•°æ®è¡¨å•
â”‚   â”‚   â”œâ”€â”€ airdrop-table.tsx    # ç©ºæŠ•æ•°æ®è¡¨æ ¼
â”‚   â”‚   â””â”€â”€ delete-confirm-dialog.tsx # åˆ é™¤ç¡®è®¤å¯¹è¯æ¡†
â”‚   â”œâ”€â”€ revenue/                 # æ”¶ç›Šåˆ†æç»„ä»¶
â”‚   â”œâ”€â”€ points/                  # ç§¯åˆ†è®¡ç®—ç»„ä»¶
â”‚   â”œâ”€â”€ airdrop/                 # ç©ºæŠ•å±•ç¤ºç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ airdrop-history.tsx  # ç©ºæŠ•å†å²é¡µé¢
â”‚   â”‚   â”œâ”€â”€ history-table.tsx    # å†å²æ•°æ®è¡¨æ ¼
â”‚   â”‚   â”œâ”€â”€ history-chart.tsx    # å†å²æ•°æ®å›¾è¡¨
â”‚   â”‚   â””â”€â”€ current-airdrops.tsx # å½“å‰ç©ºæŠ•å±•ç¤º
â”‚   â””â”€â”€ layout/                  # å¸ƒå±€ç»„ä»¶
â”œâ”€â”€ lib/                         # æ ¸å¿ƒåº“
â”‚   â”œâ”€â”€ core/                    # æ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ api/                 # APIç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ config-manager.ts    # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ token-manager.ts     # ä»£å¸ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ logger/              # æ—¥å¿—ç³»ç»Ÿ
â”‚   â”‚   â””â”€â”€ utils.ts             # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ prisma.ts                # Prisma å®¢æˆ·ç«¯å®ä¾‹
â”‚   â””â”€â”€ features/                # ä¸šåŠ¡åŠŸèƒ½æ¨¡å—
â”‚       â”œâ”€â”€ revenue/             # æ”¶ç›Šåˆ†æ
â”‚       â”œâ”€â”€ points/              # ç§¯åˆ†è®¡ç®—
â”‚       â””â”€â”€ airdrop/             # ç©ºæŠ•æ•°æ®å¤„ç†
â”‚           â”œâ”€â”€ index.ts         # ç©ºæŠ•åŠŸèƒ½æ¨¡å—
â”‚           â””â”€â”€ validation.ts    # æ•°æ®éªŒè¯æ¨¡å—
â”œâ”€â”€ prisma/                      # æ•°æ®åº“ç›¸å…³
â”‚   â””â”€â”€ schema.prisma            # æ•°æ®åº“æ¨¡å‹å®šä¹‰
â”œâ”€â”€ scripts/                     # å·¥å…·è„šæœ¬
â”‚   â”œâ”€â”€ check-duplicates.ts      # æ•°æ®é‡å¤æ£€æŸ¥
â”‚   â””â”€â”€ test-db.ts               # æ•°æ®åº“è¿æ¥æµ‹è¯•
â”œâ”€â”€ types/                       # TypeScriptç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ index.ts                 # ç»Ÿä¸€å¯¼å‡º
â”‚   â”œâ”€â”€ api.ts                   # APIç±»å‹
â”‚   â”œâ”€â”€ wallet.ts                # é’±åŒ…ç±»å‹
â”‚   â”œâ”€â”€ airdrop.ts               # ç©ºæŠ•æ•°æ®ç±»å‹
â”‚   â”œâ”€â”€ ui.ts                    # UIç»„ä»¶ç±»å‹
â”‚   â”œâ”€â”€ business.ts              # ä¸šåŠ¡é€»è¾‘ç±»å‹
â”‚   â””â”€â”€ common.ts                # é€šç”¨ç±»å‹
â”œâ”€â”€ public/                      # é™æ€èµ„æº
â”‚   â”œâ”€â”€ config/                  # å…¬å¼€é…ç½®
â”‚   â”‚   â””â”€â”€ tokens.json          # ä»£å¸é…ç½®
â”‚   â””â”€â”€ data/                    # é™æ€æ•°æ®
â””â”€â”€ docs/                        # æ–‡æ¡£
    â”œâ”€â”€ deployment-guide.md      # éƒ¨ç½²æŒ‡å—
    â””â”€â”€ ARCHITECTURE.md          # æ¶æ„æ–‡æ¡£ (æœ¬æ–‡ä»¶)
```

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½

### ç©ºæŠ•æ•°æ®ç®¡ç†æ¶æ„

#### ç»Ÿä¸€çš„APIæ¶æ„
```typescript
// å‰ç«¯å±•ç¤ºï¼šåªè¯»APIç«¯ç‚¹
GET /api/airdrop          // è·å–æ‰€æœ‰ç©ºæŠ•æ•°æ®ç”¨äºå±•ç¤º

// ç®¡ç†ç•Œé¢ï¼šå®Œæ•´CRUD APIç«¯ç‚¹
GET    /api/admin/airdrop // è·å–æ‰€æœ‰ç©ºæŠ•æ•°æ®ï¼ˆç®¡ç†å‘˜è§†å›¾ï¼‰
POST   /api/admin/airdrop // åˆ›å»ºæ–°çš„ç©ºæŠ•æ•°æ®
PUT    /api/admin/airdrop // æ›´æ–°ç°æœ‰ç©ºæŠ•æ•°æ®
DELETE /api/admin/airdrop // åˆ é™¤ç©ºæŠ•æ•°æ®

// Webç®¡ç†ç•Œé¢
http://localhost:3000/admin     // æœ¬åœ°ç®¡ç†ç•Œé¢
https://your-domain.com/admin   // éƒ¨ç½²åç®¡ç†ç•Œé¢
```

#### æ¶æ„ä¼˜åŠ¿
- **ç»Ÿä¸€æ¶æ„**: å‰ç«¯å±•ç¤ºå’Œç®¡ç†ä½¿ç”¨ç»Ÿä¸€çš„APIæ¶æ„
- **ä¾¿æ·ç®¡ç†**: Webç•Œé¢éšæ—¶éšåœ°è®¿é—®ï¼Œæ”¯æŒæ‰‹æœºå’Œç”µè„‘
- **æ•°æ®éªŒè¯**: å®Œæ•´çš„æ•°æ®éªŒè¯å’Œäº’æ–¥çº¦æŸæ£€æŸ¥
- **å®‰å…¨ä¿æŠ¤**: ç®¡ç†å‘˜å¯†é’¥ä¿æŠ¤ï¼Œç¡®ä¿æ•°æ®å®‰å…¨

#### æ•°æ®åº“è®¾è®¡
```sql
-- ç©ºæŠ•æ•°æ®è¡¨ (ç®€åŒ–ç‰ˆ)
CREATE TABLE airdrops (
  id SERIAL PRIMARY KEY,
  token VARCHAR UNIQUE NOT NULL,  -- ä»£å¸åç§° (å”¯ä¸€çº¦æŸ)
  date VARCHAR NOT NULL,          -- ç©ºæŠ•æ—¥æœŸ
  type airdrop_type NOT NULL,     -- alpha | tge
  amount DECIMAL NOT NULL,        -- ç©ºæŠ•æ•°é‡
  points INTEGER,                 -- å…ˆåˆ°å…ˆå¾—ç§¯åˆ†é—¨æ§›
  phase1_points INTEGER,          -- ä¸¤é˜¶æ®µï¼šä¼˜å…ˆè·å–ç§¯åˆ†
  phase2_points INTEGER,          -- ä¸¤é˜¶æ®µï¼šå…ˆåˆ°å…ˆå¾—ç§¯åˆ†
  -- å…¶ä»–å­—æ®µ...
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

â”œâ”€â”€ public/                      # é™æ€èµ„æº
â”‚   â”œâ”€â”€ config/                  # å…¬å¼€é…ç½®
â”‚   â”‚   â””â”€â”€ tokens.json          # ä»£å¸é…ç½®
â”‚   â””â”€â”€ data/                    # é™æ€æ•°æ®
â”‚       â””â”€â”€ airdrop-history.json # ç©ºæŠ•å†å²
â”œâ”€â”€ stores/                      # çŠ¶æ€ç®¡ç† (Zustand)
â””â”€â”€ hooks/                       # è‡ªå®šä¹‰React Hooks
```

## ğŸ›ï¸ åˆ†å±‚æ¶æ„è®¾è®¡

### 1. è¡¨ç°å±‚ (Presentation Layer)

#### **Next.js 14 App Router æ¶æ„**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              app/layout.tsx                 â”‚  â† æ ¹å¸ƒå±€ (Server Component)
â”‚                    â†“                        â”‚
â”‚              app/page.tsx                   â”‚  â† ä¸»é¡µé¢ (Server Component)
â”‚                    â†“                        â”‚
â”‚          components/layout/                 â”‚  â† å¸ƒå±€ç»„ä»¶ (Client Component)
â”‚                    â†“                        â”‚
â”‚     components/revenue/index.tsx            â”‚  â† æ”¶ç›Šåˆ†æç»„ä»¶
â”‚     components/points/index.tsx             â”‚  â† ç§¯åˆ†è®¡ç®—ç»„ä»¶
â”‚     components/airdrop/index.tsx            â”‚  â† ç©ºæŠ•ç®¡ç†ç»„ä»¶
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**èŒè´£åˆ†å·¥**ï¼š
- **Server Components**: é™æ€å†…å®¹æ¸²æŸ“ã€SEOä¼˜åŒ–ã€åˆå§‹æ•°æ®è·å–
- **Client Components**: ç”¨æˆ·äº¤äº’ã€çŠ¶æ€ç®¡ç†ã€åŠ¨æ€æ•°æ®æ›´æ–°
- **ä¸šåŠ¡ç»„ä»¶**: å…·ä½“åŠŸèƒ½å®ç°ã€æ•°æ®å±•ç¤ºã€ç”¨æˆ·æ“ä½œ

#### **ç»„ä»¶è®¾è®¡åŸåˆ™**
- **å•ä¸€èŒè´£**: æ¯ä¸ªç»„ä»¶åªè´Ÿè´£ä¸€ä¸ªæ˜ç¡®çš„åŠŸèƒ½
- **æ•°æ®é©±åŠ¨**: ç»„ä»¶é€šè¿‡Propsæ¥æ”¶æ•°æ®ï¼Œé€šè¿‡å›è°ƒå‡½æ•°é€šä¿¡
- **ç±»å‹å®‰å…¨**: æ‰€æœ‰Propséƒ½æœ‰å®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰

### 2. APIè·¯ç”±å±‚ (API Routes Layer)

#### **æœåŠ¡ç«¯APIæ¶æ„**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            app/api/                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚     revenue/analyze/route.ts            â”‚â”‚  â† æ”¶ç›Šåˆ†æAPI
â”‚  â”‚            â†“                            â”‚â”‚
â”‚  â”‚  lib/features/revenue/index.ts          â”‚â”‚  â† ä¸šåŠ¡é€»è¾‘å±‚
â”‚  â”‚            â†“                            â”‚â”‚
â”‚  â”‚  lib/core/api/clients/                  â”‚â”‚  â† APIå®¢æˆ·ç«¯å±‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**APIè®¾è®¡åŸåˆ™**ï¼š
- **RESTfulé£æ ¼**: æ¸…æ™°çš„èµ„æºè·¯å¾„å’ŒHTTPæ–¹æ³•
- **ç»Ÿä¸€å“åº”æ ¼å¼**: æ ‡å‡†åŒ–çš„æˆåŠŸ/é”™è¯¯å“åº”ç»“æ„
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯æ•è·å’Œç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯

### 3. æ ¸å¿ƒAPIç³»ç»Ÿ (Core API System)

#### **ğŸŒŸ HTTP API å®¢æˆ·ç«¯æ¶æ„**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    HttpClient API ç®¡ç†å™¨                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ API_KEY_1   â”‚  â”‚ API_KEY_2   â”‚  â”‚ API_KEY_3   â”‚              â”‚
â”‚  â”‚ Status: âœ…  â”‚  â”‚ Status: âœ…  â”‚  â”‚ Status: âš ï¸   â”‚              â”‚
â”‚  â”‚ Requests: 80â”‚  â”‚ Requests: 45â”‚  â”‚ Requests: 95â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              APIKeyManager (rotation-based)                    â”‚
â”‚              RateLimiter (30 req/s)                           â”‚
â”‚              ParallelQueryManager (30 concurrent)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒç‰¹æ€§**ï¼š
- **å¤š API Key ç®¡ç†**: æ™ºèƒ½è½®æ¢å¤šä¸ª API Key ä»¥æé«˜è¯·æ±‚é™åˆ¶
- **è‡ªåŠ¨æ•…éšœè½¬ç§»**: API Key å¤±è´¥æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°å¯ç”¨çš„ Key
- **é€Ÿç‡é™åˆ¶**: æ™ºèƒ½æ§åˆ¶è¯·æ±‚é¢‘ç‡ï¼Œé¿å…è§¦å‘é™åˆ¶
- **é‡è¯•æœºåˆ¶**: å¤±è´¥è¯·æ±‚è‡ªåŠ¨é‡è¯•ï¼Œæé«˜æˆåŠŸç‡
- **å¹¶å‘ä¼˜åŒ–**: æœ€å¤§30ä¸ªå¹¶å‘è¯·æ±‚ï¼Œå……åˆ†åˆ©ç”¨APIé…é¢

#### **APIå®¢æˆ·ç«¯å±‚æ¶æ„**

```typescript
// lib/core/api/clients/
â””â”€â”€ http-client.ts             // HTTP API å®¢æˆ·ç«¯
```

**HttpClientæ ¸å¿ƒåŠŸèƒ½**ï¼š
```typescript
class HttpClient {
  // API Key ç®¡ç†
  private keyManager: APIKeyManager
  private rateLimiter: RateLimiter
  private parallelManager: ParallelQueryManager

  // HTTP è¯·æ±‚æ‰§è¡Œ
  async request(url: string, options: HttpRequestOptions): Promise<Response>

  // æ‰¹é‡è¯·æ±‚å¤„ç†
  async batchRequests(requests: HttpBatchRequest[]): Promise<BatchResult[]>
}
```

#### **å¹¶è¡ŒæŸ¥è¯¢ç®¡ç†å™¨**

```typescript
// lib/core/api/core/parallel-query.ts
class ParallelQueryManager {
  // è¯·æ±‚é˜Ÿåˆ—ç®¡ç†
  private requestQueue: QueueItem[]
  private activeRequests: Set<string>

  // æ‰¹é‡å¹¶è¡Œæ‰§è¡Œ
  async executeBatch<T>(requests: RequestFunction<T>[], config: BatchQueryConfig): Promise<T[]>

  // æ™ºèƒ½é‡è¯•æœºåˆ¶
  private async executeWithRetry<T>(request: RequestFunction<T>): Promise<T>
}
```

**å¹¶è¡ŒæŸ¥è¯¢ç‰¹æ€§**ï¼š
- **æ™ºèƒ½æ‰¹å¤„ç†**: è‡ªåŠ¨å°†è¯·æ±‚åˆ†ç»„ï¼Œé¿å…APIé™æµ
- **å¹¶å‘æ§åˆ¶**: ç²¾ç¡®æ§åˆ¶åŒæ—¶è¿›è¡Œçš„è¯·æ±‚æ•°é‡
- **å¤±è´¥é‡è¯•**: æŒ‡æ•°é€€é¿é‡è¯•ç­–ç•¥ï¼Œæé«˜æˆåŠŸç‡
- **è¿›åº¦è·Ÿè¸ª**: å®æ—¶æŠ¥å‘Šæ‰¹é‡æ“ä½œè¿›åº¦

### 4. ä¸šåŠ¡é€»è¾‘å±‚ (Business Logic Layer)

#### **æ”¶ç›Šåˆ†ææ ¸å¿ƒä¸šåŠ¡æµç¨‹**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ”¶ç›Šåˆ†æä¸šåŠ¡æµç¨‹ï¼ˆå®é™…å®ç°ç‰ˆï¼‰                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é˜¶æ®µä¸€ï¼šåŸºç¡€æ•°æ®å‡†å¤‡ï¼ˆä¸²è¡Œæ‰§è¡Œï¼‰                                â”‚
â”‚  1. é’±åŒ…åœ°å€éªŒè¯ â†’ 2. æ—¶é—´èŒƒå›´è®¡ç®— â†’ 3. åŒºå—èŒƒå›´è·å– â†’ 4. ä»·æ ¼æ•°æ®è·å– â”‚
â”‚                                                                 â”‚
â”‚  é˜¶æ®µäºŒï¼šå¹¶è¡ŒæŸ¥è¯¢+è®¡ç®—ï¼ˆAPIè°ƒç”¨+å†…åµŒè®¡ç®—ï¼‰                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚     ä»£å¸ä½™é¢æŸ¥è¯¢+ä»·å€¼è®¡ç®—    â”‚  â”‚     äº¤æ˜“å†å²åˆ†æ+ç£¨æŸè®¡ç®—    â”‚â”‚
â”‚  â”‚                             â”‚  â”‚                             â”‚â”‚
â”‚  â”‚ â€¢ API: è·å–ä»£å¸æ•°é‡         â”‚  â”‚ â€¢ API: è·å–äº¤æ˜“è®°å½•         â”‚â”‚
â”‚  â”‚ â€¢ è®¡ç®—: æ•°é‡Ã—ä»·æ ¼=ä»·å€¼      â”‚  â”‚ â€¢ è®¡ç®—: ä¹°å–å·®ä»·ç£¨æŸ        â”‚â”‚
â”‚  â”‚ â€¢ è®¡ç®—: ç´¯è®¡æ€»ä»·å€¼          â”‚  â”‚ â€¢ è®¡ç®—: Gasè´¹ç”¨ç»Ÿè®¡         â”‚â”‚
â”‚  â”‚ â€¢ è¾“å‡º: TokenBalanceAnalysisâ”‚  â”‚ â€¢ è¾“å‡º: TransactionSummary  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                    â†“                         â†“                  â”‚
â”‚              ä¸¤ä¸ªå¹¶è¡Œä»»åŠ¡åŒæ—¶è¿›è¡Œï¼Œå†…åµŒè®¡ç®—æå‡æ•ˆç‡              â”‚
â”‚                                                                 â”‚
â”‚  é˜¶æ®µä¸‰ï¼šç»“æœæ±‡æ€»                                               â”‚
â”‚  ç§¯åˆ†è®¡ç®— â†’ ç»“æœå°è£… â†’ è¿”å›æ•°æ®                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### **æ ¸å¿ƒä¸šåŠ¡æœåŠ¡**

```typescript
// lib/features/revenue/
â”œâ”€â”€ index.ts                   // æ”¶ç›Šåˆ†æä¸»æœåŠ¡
â”œâ”€â”€ token-service.ts           // ä»£å¸ä½™é¢æœåŠ¡
â”œâ”€â”€ transaction-service.ts     // äº¤æ˜“åˆ†ææœåŠ¡
â”œâ”€â”€ points-service.ts          // ç§¯åˆ†è®¡ç®—æœåŠ¡
â””â”€â”€ api-clients.ts            // APIå®¢æˆ·ç«¯ç®¡ç†
```

**1. ä»£å¸ä½™é¢æœåŠ¡ (TokenService)**
```typescript
class TokenService {
  // è·å–é’±åŒ…ä»£å¸ä½™é¢
  async getWalletTokenBalances(address: string, tokenData: TokenDataOfNetwork): Promise<TokenBalance[]>

  // è®¡ç®—ä»£å¸USDTä»·å€¼
  async calculateTokenValues(balances: TokenBalance[], priceMap: Map<string, number>): Promise<number>

  // è·å–ä»£å¸ä»·æ ¼æ˜ å°„
  async getTokenPriceMap(tokens: TokenInfo[]): Promise<Map<string, number>>
}
```

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- **å¤šä»£å¸å¹¶è¡ŒæŸ¥è¯¢**: åŒæ—¶è·å–BNBã€USDTã€ZKJã€KOGEã€ABã€BRç­‰ä»£å¸ä½™é¢
- **ä»·æ ¼å®æ—¶è½¬æ¢**: ç»Ÿä¸€è½¬æ¢ä¸ºUSDTä»·å€¼ï¼Œä¾¿äºç§¯åˆ†è®¡ç®—
- **ç¼“å­˜ä¼˜åŒ–**: ä»£å¸ä»·æ ¼ç¼“å­˜10åˆ†é’Ÿï¼Œä½™é¢æ•°æ®ç¼“å­˜5åˆ†é’Ÿ

**2. äº¤æ˜“åˆ†ææœåŠ¡ (TransactionService)**
```typescript
class TransactionService {
  // è·å–äº¤æ˜“æ±‡æ€»æ•°æ®
  async getTransactionSummary(address: string, startBlock: number, endBlock: number, tokenData: TokenDataOfNetwork): Promise<TransactionSummary>

  // åˆ†æä¹°å…¥äº¤æ˜“
  private analyzeBuyTransactions(transactions: any[], tokenData: TokenDataOfNetwork): BuyTransaction[]

  // è®¡ç®—äº¤æ˜“ç£¨æŸ
  private calculateTradingLoss(transactions: BuyTransaction[]): number
}
```

**äº¤æ˜“åˆ†æç®—æ³•**ï¼š
- **æ—¶é—´èŒƒå›´ç²¾ç¡®è®¡ç®—**: æ¯æ—¥8:00-æ¬¡æ—¥7:59 (UTC+8) çš„ç²¾ç¡®åŒºå—èŒƒå›´
- **æœ‰æ•ˆäº¤æ˜“è¯†åˆ«**: ç­›é€‰çœŸå®çš„ä»£å¸è´­ä¹°äº¤æ˜“ï¼Œæ’é™¤é“¸å¸ç­‰æ— æ•ˆäº¤æ˜“
- **ç£¨æŸè®¡ç®—**: åŸºäºä¹°å…¥ä»·æ ¼ä¸å½“å‰ä»·æ ¼çš„å·®å¼‚è®¡ç®—äº¤æ˜“ç£¨æŸ
- **Gasè´¹ç»Ÿè®¡**: æ‰€æœ‰äº¤æ˜“çš„Gasè´¹ç”¨æŒ‰BNBä»·æ ¼è½¬æ¢ä¸ºUSDTæˆæœ¬

**3. ç§¯åˆ†è®¡ç®—æœåŠ¡ (PointsService)**
```typescript
class PointsService {
  // è®¡ç®—ä½™é¢ç§¯åˆ†
  calculateBalancePoints(tokenValue: number): number

  // è®¡ç®—äº¤æ˜“ç§¯åˆ†
  calculateVolumePoints(transactionSummary: TransactionSummary): number

  // è®¡ç®—æ€»ç§¯åˆ†
  calculateTotalPoints(balancePoints: number, volumePoints: number): number
}
```

**ç§¯åˆ†è®¡ç®—è§„åˆ™**ï¼š
- **ä½™é¢ç§¯åˆ†**: åŸºäºé’±åŒ…æ€»USDTä»·å€¼ï¼ŒæŒ‰å›ºå®šæ¯”ä¾‹è®¡ç®—
- **äº¤æ˜“ç§¯åˆ†**: åŸºäºæœ‰æ•ˆäº¤æ˜“æ•°é‡å’Œäº¤æ˜“é‡‘é¢ï¼ŒBSCé“¾è‡ªåŠ¨ç¿»å€
- **ç‰¹æ®Šè§„åˆ™**: æ”¯æŒä¸åŒä»£å¸çš„ç§¯åˆ†æƒé‡é…ç½®

### 5. é…ç½®ç®¡ç†ç³»ç»Ÿ (Configuration Management)

#### **ğŸŒŸ é›¶é…ç½®æ™ºèƒ½æ¶æ„**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é›¶é…ç½®æ™ºèƒ½ç®¡ç†ç³»ç»Ÿ                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   ç¯å¢ƒå˜é‡      â”‚  â”‚   æ™ºèƒ½ç®—æ³•      â”‚  â”‚   ä»£å¸é…ç½®      â”‚  â”‚
â”‚  â”‚   .env          â”‚  â”‚   ä»£ç å†…ç½®      â”‚  â”‚   public/       â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚   config/       â”‚  â”‚
â”‚  â”‚ MORALIS_API_*   â”‚  â”‚ ğŸ§  åŠ¨æ€è®¡ç®—     â”‚  â”‚   tokens.json   â”‚  â”‚
â”‚  â”‚ NODE_ENV        â”‚  â”‚ ğŸ“Š è‡ªåŠ¨ä¼˜åŒ–     â”‚  â”‚                 â”‚  â”‚
â”‚  â”‚ LOG_LEVEL       â”‚  â”‚ âš¡ å®æ—¶è°ƒæ•´     â”‚  â”‚ ä»£å¸åœ°å€/äº¤æ˜“å¯¹  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                  â”‚
â”‚                    ConfigManager é›¶é…ç½®ç®¡ç†                     â”‚
â”‚                              â†“                                  â”‚
â”‚              ğŸ¯ getDynamicConfig() ä¸€é”®æ™ºèƒ½ä¼˜åŒ–                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿**ï¼š
- **é›¶é…ç½®æ–‡ä»¶**: ç§»é™¤æ‰€æœ‰é™æ€é…ç½®æ–‡ä»¶ï¼Œçº¯ä»£ç ç®¡ç†
- **æ™ºèƒ½ä¼˜åŒ–**: æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µè‡ªåŠ¨è°ƒæ•´æ‰€æœ‰å‚æ•°
- **å¼€ç®±å³ç”¨**: æ— éœ€æ‰‹åŠ¨é…ç½®ï¼Œç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©æœ€ä½³å‚æ•°

**ConfigManageræ ¸å¿ƒåŠŸèƒ½**ï¼š
```typescript
class ConfigManager {
  // ç¯å¢ƒå˜é‡ç®¡ç†
  getEnvConfig(): EnvConfig

  // ğŸŒŸ æ™ºèƒ½åŠ¨æ€é…ç½®ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
  getDynamicConfig(apiKeyCount: number, analysisScale: number): DynamicAPIConfig

  // åŸºç¡€é…ç½®è·å–ï¼ˆå†…éƒ¨ä½¿ç”¨ï¼‰
  getAPIConfig(): APIConfig
  getHttpConfig(): HttpClientConfig
}
```

**æ¨èä½¿ç”¨æ–¹å¼**ï¼š
```typescript
// âœ… æ¨èï¼šä½¿ç”¨åŠ¨æ€é…ç½®ï¼ˆè‡ªåŠ¨ä¼˜åŒ–ï¼‰
import { getDynamicConfig, getEnvConfig } from '@/lib/core/config-manager'

const envConfig = getEnvConfig()
const apiKeyCount = envConfig.moralisApiKeys.length
const dynamicConfig = getDynamicConfig(apiKeyCount, walletCount)

// âŒ ä¸æ¨èï¼šä½¿ç”¨é™æ€é…ç½®
const staticConfig = getAPIConfig() // å‚æ•°å›ºå®šï¼Œæ— æ³•ä¼˜åŒ–
```

**æ™ºèƒ½é…ç½®ç‰¹æ€§**ï¼š
- **ğŸ¯ åŠ¨æ€ä¼˜åŒ–**: æ ¹æ®APIå¯†é’¥æ•°é‡å’Œåˆ†æè§„æ¨¡è‡ªåŠ¨è°ƒæ•´å‚æ•°
- **ğŸ“Š æ™ºèƒ½è®¡ç®—**: å¹¶å‘æ•°ã€æ‰¹é‡å¤§å°ã€é€Ÿç‡é™åˆ¶è‡ªåŠ¨ä¼˜åŒ–
- **ğŸ”’ ç±»å‹å®‰å…¨**: å®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰å’ŒéªŒè¯
- **âš¡ é›¶é…ç½®**: æ— éœ€æ‰‹åŠ¨é…ç½®æ–‡ä»¶ï¼Œå¼€ç®±å³ç”¨
- **ğŸš€ æ€§èƒ½ä¼˜åŒ–**: è‡ªåŠ¨é€‰æ‹©æœ€ä½³å‚æ•°ç»„åˆï¼Œæå‡å¤„ç†æ•ˆç‡

### **ğŸŒŸ æ™ºèƒ½é…ç½®ç®—æ³•è¯¦è§£**

#### **ğŸ§  é›¶é…ç½®æ™ºèƒ½è®¡ç®—**

```typescript
// ğŸ¯ ä¸€é”®æ™ºèƒ½ä¼˜åŒ– - æ— éœ€æ‰‹åŠ¨é…ç½®
getDynamicConfig(apiKeyCount: number, analysisScale: number): DynamicAPIConfig {
  // 1. ğŸš€ åŸºäºAPIå¯†é’¥æ•°é‡è‡ªåŠ¨æ‰©å±•æ€§èƒ½
  const concurrencyMultiplier = Math.min(apiKeyCount, 3) // æœ€å¤š3å€æ€§èƒ½æå‡
  const maxConcurrentRequests = Math.min(30 * concurrencyMultiplier, 50) // è‡ªåŠ¨è°ƒæ•´å¹¶å‘
  const requestsPerSecond = Math.min(30 * concurrencyMultiplier, 100)    // è‡ªåŠ¨è°ƒæ•´é€Ÿç‡

  // 2. ğŸ“Š åŸºäºåˆ†æè§„æ¨¡æ™ºèƒ½ä¼˜åŒ–æ‰¹é‡å¤„ç†
  const batchSize = calculateOptimalBatchSize(analysisScale, apiKeyCount)

  // 3. âš¡ è¿”å›å®Œå…¨ä¼˜åŒ–çš„é…ç½® - é›¶æ‰‹åŠ¨è°ƒæ•´
  return fullyOptimizedConfig
}
```

**ğŸ¯ æ™ºèƒ½ä¼˜åŒ–ç­–ç•¥**ï¼š
- **è‡ªåŠ¨æ‰©å±•**: APIå¯†é’¥è¶Šå¤šï¼Œæ€§èƒ½è‡ªåŠ¨æå‡è¶Šæ˜æ˜¾
- **æ™ºèƒ½æ‰¹é‡**: æ ¹æ®é’±åŒ…æ•°é‡è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜æ‰¹é‡å¤§å°
- **åŠ¨æ€è°ƒæ•´**: å®æ—¶æ ¹æ®è´Ÿè½½æƒ…å†µè°ƒæ•´å‚æ•°
- **é›¶å¹²é¢„**: å¼€å‘è€…æ— éœ€å…³å¿ƒä»»ä½•é…ç½®ç»†èŠ‚

#### **æ‰¹é‡å¤§å°æ™ºèƒ½è®¡ç®—**

| åˆ†æè§„æ¨¡ | ç­–ç•¥ | æ‰¹é‡å¤§å°è®¡ç®— | è¯´æ˜ |
|---------|------|-------------|------|
| â‰¤5ä¸ªé’±åŒ… | ç²¾ç¡®æ§åˆ¶ | `min(analysisScale, 5)` | æ¯ä¸ªé’±åŒ…ä¸€ä¸ªæ‰¹æ¬¡ |
| 6-20ä¸ªé’±åŒ… | å¹³å‡åˆ†é… | `ceil(analysisScale / apiKeyCount)` | å¹³å‡åˆ†é…ç»™APIå¯†é’¥ |
| >20ä¸ªé’±åŒ… | å¤§æ‰¹æ¬¡ä¼˜åŒ– | `min(20, ceil(analysisScale / (apiKeyCount * 2)))` | æ›´å¤§æ‰¹æ¬¡æé«˜æ•ˆç‡ |

### **ğŸ¯ é›¶é…ç½®ä½¿ç”¨æŒ‡å—**

#### **å¼€å‘è€…ä½“éªŒ**

```typescript
import { RevenueAnalyzer } from '@/lib/features/revenue'

// ç³»ç»Ÿè‡ªåŠ¨æ ¹æ®é’±åŒ…æ•°é‡ä¼˜åŒ–æ‰€æœ‰å‚æ•°
const results = await RevenueAnalyzer.analyzeMultipleWallets(
  walletAddresses, // 5ä¸ªé’±åŒ… -> è‡ªåŠ¨ä¼˜åŒ–ä¸ºé«˜æ€§èƒ½é…ç½®
  dateStr
)
```

#### **é…ç½®æ–‡ä»¶**

```bash
.env                          # åªéœ€è¦APIå¯†é’¥
â”œâ”€â”€ MORALIS_API_KEY_1
â”œâ”€â”€ MORALIS_API_KEY_2
â””â”€â”€ MORALIS_API_KEY_3
```

## ğŸ”„ æ”¶ç›ŠæŸ¥è¯¢å®Œæ•´æµç¨‹

### **å‰ç«¯æŸ¥è¯¢æµç¨‹**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·æ“ä½œæµç¨‹                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. ç”¨æˆ·è¾“å…¥é’±åŒ…åœ°å€ â†’ 2. é€‰æ‹©æŸ¥è¯¢æ—¥æœŸ â†’ 3. ç‚¹å‡»æŸ¥è¯¢æŒ‰é’®         â”‚
â”‚           â†“                    â†“                â†“               â”‚
â”‚  4. å‰ç«¯éªŒè¯åœ°å€æ ¼å¼ â†’ 5. æ„å»ºè¯·æ±‚å‚æ•° â†’ 6. è°ƒç”¨åç«¯API         â”‚
â”‚           â†“                    â†“                â†“               â”‚
â”‚  7. æ˜¾ç¤ºåŠ è½½çŠ¶æ€ â†’ 8. æ¥æ”¶å“åº”æ•°æ® â†’ 9. æ¸²æŸ“ç»“æœç•Œé¢             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å‰ç«¯ç»„ä»¶äº¤äº’**ï¼š
```typescript
// components/revenue/index.tsx
const handleAnalyze = async () => {
  setIsLoading(true)

  try {
    // 1. æ„å»ºè¯·æ±‚å‚æ•°
    const requestBody = {
      walletAddresses: wallets.map(w => w.address),
      date: selectedDate,
      config: {
        batchSize: 10,
        concurrency: 30,
        retryAttempts: 3
      }
    }

    // 2. è°ƒç”¨åç«¯API
    const response = await fetch('/api/revenue/analyze', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(requestBody)
    })

    // 3. å¤„ç†å“åº”
    const result: AnalyzeResponse = await response.json()

    // 4. æ›´æ–°UIçŠ¶æ€
    if (result.success && result.data) {
      setWalletData(result.data.wallets)
      setHasQueried(true)
    }
  } catch (error) {
    // é”™è¯¯å¤„ç†
  } finally {
    setIsLoading(false)
  }
}
```

### **åç«¯APIå¤„ç†æµç¨‹**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 app/api/revenue/analyze/route.ts                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. æ¥æ”¶POSTè¯·æ±‚ â†’ 2. å‚æ•°éªŒè¯ â†’ 3. åˆå§‹åŒ–APIå®¢æˆ·ç«¯              â”‚
â”‚           â†“              â†“              â†“                       â”‚
â”‚  4. è°ƒç”¨ä¸šåŠ¡é€»è¾‘ â†’ 5. å¹¶è¡Œå¤„ç†é’±åŒ… â†’ 6. æ±‡æ€»ç»Ÿè®¡æ•°æ®             â”‚
â”‚           â†“              â†“              â†“                       â”‚
â”‚  7. é”™è¯¯å¤„ç† â†’ 8. æ„å»ºå“åº” â†’ 9. è¿”å›JSONç»“æœ                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**APIè·¯ç”±æ ¸å¿ƒä»£ç **ï¼š
```typescript
// app/api/revenue/analyze/route.ts
export async function POST(request: NextRequest) {
  try {
    // 1. è§£æè¯·æ±‚å‚æ•°
    const { walletAddresses, date, config }: AnalyzeRequest = await request.json()

    // 2. åˆå§‹åŒ–APIå®¢æˆ·ç«¯
    const httpClient = await APIClients.getHttpClient()

    // 3. è°ƒç”¨æ”¶ç›Šåˆ†ææœåŠ¡
    const revenue = new Revenue(httpClient)
    const results = await revenue.analyzeWallets(walletAddresses, date, config)

    // 4. æ„å»ºå“åº”
    return NextResponse.json({
      success: true,
      data: {
        wallets: results.wallets,
        summary: results.summary
      }
    })
  } catch (error) {
    // é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
    return NextResponse.json({
      success: false,
      error: error.message
    }, { status: 500 })
  }
}
```

### **æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å¤„ç†æµç¨‹**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                lib/features/revenue/index.ts                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. æ—¶é—´èŒƒå›´è®¡ç®— â†’ 2. åŒºå—èŒƒå›´è·å– â†’ 3. ä»£å¸é…ç½®åŠ è½½             â”‚
â”‚           â†“              â†“              â†“                       â”‚
â”‚  4. å¹¶è¡Œé’±åŒ…åˆ†æ â†’ 5. ä»£å¸ä½™é¢æŸ¥è¯¢ â†’ 6. äº¤æ˜“å†å²åˆ†æ             â”‚
â”‚           â†“              â†“              â†“                       â”‚
â”‚  7. ç§¯åˆ†è®¡ç®— â†’ 8. ç£¨æŸåˆ†æ â†’ 9. ç»“æœæ±‡æ€»                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Revenueç±»æ ¸å¿ƒæ–¹æ³•**ï¼š
```typescript
class Revenue {
  // åˆ†æå¤šä¸ªé’±åŒ…
  async analyzeWallets(addresses: string[], date: string, config?: BatchConfig): Promise<AnalyzeResult>

  // åˆ†æå•ä¸ªé’±åŒ…
  async analyzeWallet(address: string, startBlock: number, endBlock: number, tokenData: TokenDataOfNetwork): Promise<WalletData>

  // è®¡ç®—æ—¶é—´èŒƒå›´
  private calculateTimeRange(date: string): { startTime: number, endTime: number }

  // è·å–åŒºå—èŒƒå›´
  private async getBlockRange(startTime: number, endTime: number): Promise<{ startBlock: number, endBlock: number }>
}
```

### **å•ä¸ªé’±åŒ…åˆ†æè¯¦ç»†æµç¨‹**

#### **ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ•°æ®å‡†å¤‡ï¼ˆä¸²è¡Œæ‰§è¡Œï¼‰**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åŸºç¡€æ•°æ®å‡†å¤‡é˜¶æ®µ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. é’±åŒ…åœ°å€éªŒè¯                                                â”‚
â”‚     â€¢ è¾“å…¥: "0x1234...abcd"                                    â”‚
â”‚     â€¢ éªŒè¯: åœ°å€æ ¼å¼å’Œæ ¡éªŒå’Œ                                    â”‚
â”‚     â€¢ è¾“å‡º: æ ‡å‡†åŒ–é’±åŒ…åœ°å€                                      â”‚
â”‚                              â†“                                  â”‚
â”‚  2. æ—¶é—´èŒƒå›´è®¡ç®—                                                â”‚
â”‚     â€¢ è¾“å…¥: "2024-01-15"                                       â”‚
â”‚     â€¢ è®¡ç®—: 2024-01-15 08:00 ~ 2024-01-16 07:59 (UTC+8)       â”‚
â”‚     â€¢ è¾“å‡º: startTime, endTime (Unixæ—¶é—´æˆ³)                     â”‚
â”‚                              â†“                                  â”‚
â”‚  3. åŒºå—èŒƒå›´è·å–                                                â”‚
â”‚     â€¢ è°ƒç”¨: HTTP API (deep-index.moralis.io)                  â”‚
â”‚     â€¢ è¾“å…¥: startTime, endTime                                 â”‚
â”‚     â€¢ è¾“å‡º: startBlock, endBlock                               â”‚
â”‚                              â†“                                  â”‚
â”‚  4. ä»·æ ¼æ•°æ®è·å–ï¼ˆå…³é”®ï¼šå¿…é¡»åœ¨ä½™é¢æŸ¥è¯¢å‰å®Œæˆï¼‰                   â”‚
â”‚     â€¢ è°ƒç”¨: HTTP API (deep-index.moralis.io)                  â”‚
â”‚     â€¢ è·å–: BNB, ZKJ, KOGE, AB, BR çš„USDTä»·æ ¼                 â”‚
â”‚     â€¢ è¾“å‡º: TokenPriceMap (ä»£å¸ä»·æ ¼æ˜ å°„)                        â”‚
â”‚                              â†“                                  â”‚
â”‚  5. ä»£å¸é…ç½®åŠ è½½                                                â”‚
â”‚     â€¢ è¯»å–: public/config/tokens.json                         â”‚
â”‚     â€¢ è§£æ: æ”¯æŒçš„ä»£å¸åˆ—è¡¨å’Œäº¤æ˜“å¯¹é…ç½®                          â”‚
â”‚     â€¢ è¾“å‡º: TokenDataOfNetwork                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### **ç¬¬äºŒé˜¶æ®µï¼šå¹¶è¡ŒæŸ¥è¯¢+è®¡ç®—ï¼ˆAPIè°ƒç”¨+å†…åµŒè®¡ç®—ï¼‰**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¹¶è¡ŒæŸ¥è¯¢+è®¡ç®—é˜¶æ®µ                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   ä»£å¸ä½™é¢æŸ¥è¯¢+ä»·å€¼è®¡ç®—      â”‚  â”‚   äº¤æ˜“å†å²åˆ†æ+ç£¨æŸè®¡ç®—      â”‚â”‚
â”‚  â”‚                             â”‚  â”‚                             â”‚â”‚
â”‚  â”‚ TokenService.getBalances()  â”‚  â”‚TransactionService.getHistoryâ”‚â”‚
â”‚  â”‚                             â”‚  â”‚                             â”‚â”‚
â”‚  â”‚ ğŸ” APIè°ƒç”¨:                â”‚  â”‚ ğŸ” APIè°ƒç”¨:                â”‚â”‚
â”‚  â”‚ â€¢ BNBä½™é¢: 1.5 BNB         â”‚  â”‚ â€¢ è·å–Swapäº¤æ˜“è®°å½•          â”‚â”‚
â”‚  â”‚ â€¢ USDTä½™é¢: 100 USDT       â”‚  â”‚ â€¢ è·å–Gasè´¹ç”¨è®°å½•           â”‚â”‚
â”‚  â”‚ â€¢ ZKJä½™é¢: 1000 ZKJ        â”‚  â”‚ â€¢ è·å–äº¤æ˜“æ—¶é—´æˆ³            â”‚â”‚
â”‚  â”‚                             â”‚  â”‚                             â”‚â”‚
â”‚  â”‚ ğŸ’° å†…åµŒè®¡ç®—:               â”‚  â”‚ ğŸ“Š å†…åµŒè®¡ç®—:               â”‚â”‚
â”‚  â”‚ â€¢ BNB: 1.5Ã—$600=$900       â”‚  â”‚ â€¢ ZKJä¹°å…¥$0.5â†’å½“å‰$0.3     â”‚â”‚
â”‚  â”‚ â€¢ ZKJ: 1000Ã—$0.3=$300      â”‚  â”‚   ç£¨æŸ: $200               â”‚â”‚
â”‚  â”‚ â€¢ æ€»ä»·å€¼: $1300            â”‚  â”‚ â€¢ Gasè´¹ç”¨: $2.4            â”‚â”‚
â”‚  â”‚                             â”‚  â”‚ â€¢ æ€»ç£¨æŸ: $202.4           â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                    â†“                         â†“                  â”‚
â”‚          è¿”å›å®Œæ•´åˆ†æç»“æœ                è¿”å›å®Œæ•´äº¤æ˜“æ±‡æ€»          â”‚
â”‚      TokenBalanceAnalysis            TransactionSummary         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸš€ æ€§èƒ½ä¼˜åŒ–äº®ç‚¹**ï¼š
- **å¹¶è¡Œæ‰§è¡Œ**: ä¸¤ä¸ªå¤æ‚ä»»åŠ¡åŒæ—¶è¿›è¡Œï¼Œå……åˆ†åˆ©ç”¨å¤šæ ¸CPU
- **å†…åµŒè®¡ç®—**: æŸ¥è¯¢å’Œè®¡ç®—ä¸€ä½“åŒ–ï¼Œé¿å…æ•°æ®ä¼ é€’å¼€é”€
- **APIæ•ˆç‡**: ä¸¤ä¸ªç‹¬ç«‹çš„APIè°ƒç”¨ï¼Œå……åˆ†åˆ©ç”¨ç½‘ç»œå¸¦å®½
- **æ—¶é—´èŠ‚çœ**: ç›¸æ¯”ä¸²è¡Œæ‰§è¡Œï¼ŒèŠ‚çœçº¦50-60%çš„æ€»å¤„ç†æ—¶é—´

**ä»£ç å®ç°**ï¼š
```typescript
// âœ… å½“å‰å®ç°ï¼šå¹¶è¡ŒæŸ¥è¯¢+å†…åµŒè®¡ç®—
const [balanceAnalysis, transactionData] = await Promise.all([
    // ä»»åŠ¡1: æŸ¥è¯¢ä½™é¢ + è®¡ç®—ä»·å€¼ (ä¸€ä½“åŒ–)
    TokenService.getTokenBalances(walletAddress, moralis, tokenDataOfNetworks),
    // ä»»åŠ¡2: æŸ¥è¯¢äº¤æ˜“ + åˆ†æç£¨æŸ (ä¸€ä½“åŒ–)
    TransactionService.getWalletTransactions(walletAddress, moralis, httpClient, tokenDataOfNetworks)
])

// ç»“æœç›´æ¥å¯ç”¨ï¼Œæ— éœ€é¢å¤–è®¡ç®—æ­¥éª¤
console.log(`æ€»ä»·å€¼: $${balanceAnalysis.totalValue}`)
console.log(`æ€»ç£¨æŸ: $${transactionData.totalLoss}`)
```

#### **ç¬¬ä¸‰é˜¶æ®µï¼šç»“æœæ±‡æ€»ï¼ˆè½»é‡çº§å¤„ç†ï¼‰**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç»“æœæ±‡æ€»é˜¶æ®µ                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¾“å…¥æ•°æ®ï¼ˆå·²å®Œæˆæ‰€æœ‰è®¡ç®—ï¼‰:                                     â”‚
â”‚  â€¢ balanceAnalysis.totalValue = $1300                          â”‚
â”‚  â€¢ transactionData.totalLoss = $202.4                          â”‚
â”‚  â€¢ transactionData.buyTransactionsCount = 5                    â”‚
â”‚                              â†“                                  â”‚
â”‚  ç®€å•å°è£…å¤„ç†:                                                  â”‚
â”‚  1. æ„å»º WalletRevenueSnapshot å¯¹è±¡                            â”‚
â”‚     â€¢ walletAddress: é’±åŒ…åœ°å€                                  â”‚
â”‚     â€¢ queryDate: æŸ¥è¯¢æ—¥æœŸ                                      â”‚
â”‚     â€¢ tokensValue: $1300 (æ¥è‡ªbalanceAnalysis)                â”‚
â”‚     â€¢ transactionData: å®Œæ•´äº¤æ˜“æ±‡æ€» (æ¥è‡ªtransactionData)       â”‚
â”‚                              â†“                                  â”‚
â”‚  2. è¿”å›å®Œæ•´åˆ†æç»“æœ                                            â”‚
â”‚     â€¢ æ— éœ€é¢å¤–è®¡ç®—ï¼Œç›´æ¥ç»„è£…æ•°æ®                                â”‚
â”‚     â€¢ å¤„ç†æ—¶é—´: < 1ms                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ’¡ æ¶æ„ä¼˜åŠ¿**ï¼š
- **è®¡ç®—å‰ç½®**: æ‰€æœ‰å¤æ‚è®¡ç®—éƒ½åœ¨ç¬¬äºŒé˜¶æ®µå®Œæˆ
- **æ±‡æ€»è½»é‡**: ç¬¬ä¸‰é˜¶æ®µåªåšç®€å•çš„æ•°æ®ç»„è£…
- **æ€§èƒ½å“è¶Š**: é¿å…äº†ä¼ ç»Ÿæ¶æ„ä¸­çš„è®¡ç®—ç“¶é¢ˆ
- **ä»£ç æ¸…æ™°**: æŸ¥è¯¢å’Œè®¡ç®—é€»è¾‘å†…èšï¼Œæ˜“äºç»´æŠ¤

**å®é™…ä»£ç **ï¼š
```typescript
// ç¬¬äºŒé˜¶æ®µå®Œæˆåï¼Œæ•°æ®å·²ç»å®Œå…¨è®¡ç®—å¥½
const [balanceAnalysis, transactionData] = await Promise.all([...])

// ç¬¬ä¸‰é˜¶æ®µï¼šè½»é‡çº§æ±‡æ€»
const result = {
    walletAddress,
    queryDate: dateStr,
    tokensValue: balanceAnalysis.totalValue,  // å·²è®¡ç®—å®Œæˆ
    transactionData,                          // å·²åˆ†æå®Œæˆ
}

return result  // ç›´æ¥è¿”å›ï¼Œæ— éœ€é¢å¤–å¤„ç†
```

## ğŸ—ï¸ TypeScriptç±»å‹ç³»ç»Ÿ

### **ç»Ÿä¸€ç±»å‹ç®¡ç†æ¶æ„**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    types/ ç›®å½•ç»“æ„                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   æ ¸å¿ƒä¸šåŠ¡ç±»å‹   â”‚  â”‚   UIç»„ä»¶ç±»å‹    â”‚  â”‚   é€šç”¨å·¥å…·ç±»å‹   â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚
â”‚  â”‚ â€¢ api.ts        â”‚  â”‚ â€¢ ui.ts         â”‚  â”‚ â€¢ common.ts     â”‚  â”‚
â”‚  â”‚ â€¢ wallet.ts     â”‚  â”‚ â€¢ ç»„ä»¶Props     â”‚  â”‚ â€¢ åˆ†é¡µ/æ’åº     â”‚  â”‚
â”‚  â”‚ â€¢ transaction.tsâ”‚  â”‚ â€¢ å“åº”æ•°æ®      â”‚  â”‚ â€¢ çŠ¶æ€ç®¡ç†      â”‚  â”‚
â”‚  â”‚ â€¢ config.ts     â”‚  â”‚ â€¢ è¡¨å•ç±»å‹      â”‚  â”‚ â€¢ å·¥å…·å‡½æ•°      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                  â”‚
â”‚                    index.ts ç»Ÿä¸€å¯¼å‡º                            â”‚
â”‚                              â†“                                  â”‚
â”‚              import type { ... } from '@/types'                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç±»å‹ç³»ç»Ÿç‰¹æ€§**ï¼š
- **ğŸ¯ é›¶é‡å¤å®šä¹‰**: æ¶ˆé™¤æ‰€æœ‰é‡å¤çš„ç±»å‹å®šä¹‰
- **ğŸ“ åˆ†ç±»æ¸…æ™°**: æŒ‰åŠŸèƒ½æ¨¡å—ç§‘å­¦åˆ†ç±»ç»„ç»‡
- **ğŸ”’ ç±»å‹å®‰å…¨**: å®Œæ•´çš„TypeScriptæ”¯æŒï¼Œç¼–è¯‘æœŸé”™è¯¯æ£€æŸ¥
- **ğŸ”„ å‘åå…¼å®¹**: ä¿æŒç°æœ‰ä»£ç çš„å…¼å®¹æ€§
- **ğŸ“– æ–‡æ¡£å®Œå–„**: è¯¦ç»†çš„ç±»å‹æ³¨é‡Šå’Œä½¿ç”¨è¯´æ˜

### **æ ¸å¿ƒç±»å‹å®šä¹‰ç¤ºä¾‹**

```typescript
// types/wallet.ts - é’±åŒ…ç›¸å…³ç±»å‹
export interface WalletData {
  address: string
  note?: string
  tokensValue: number
  totalBalance?: number
  tokenBalances?: TokenBalance[]
  transactionData?: TransactionSummary
  points: number
  balancePoints: number
  volumePoints: number
  error?: string
}

// types/api.ts - APIç›¸å…³ç±»å‹
export interface APIResponse<T = any> {
  success: boolean
  data?: T
  error?: string
  responseTime?: number
  keyUsed?: string
}

// types/business.ts - ä¸šåŠ¡é€»è¾‘ç±»å‹
export interface BatchQueryConfig {
  batchSize: number
  concurrency: number
  retryAttempts: number
  timeoutPerBatch?: number
  progressCallback?: (progress: number) => void
}
```

## âš¡ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### **1. APIè°ƒç”¨ä¼˜åŒ–**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    APIæ€§èƒ½ä¼˜åŒ–ç­–ç•¥                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ å¤šå®ä¾‹è´Ÿè½½å‡è¡¡: 3ä¸ªAPIå¯†é’¥å¹¶è¡Œå·¥ä½œï¼Œæå‡34å€æŸ¥è¯¢é€Ÿåº¦          â”‚
â”‚  â€¢ æ™ºèƒ½æ‰¹å¤„ç†: è‡ªåŠ¨åˆ†ç»„è¯·æ±‚ï¼Œé¿å…APIé™æµ                        â”‚
â”‚  â€¢ å¹¶å‘æ§åˆ¶: æœ€å¤§30ä¸ªå¹¶å‘è¯·æ±‚ï¼Œå……åˆ†åˆ©ç”¨é…é¢                     â”‚
â”‚  â€¢ å¤±è´¥é‡è¯•: æŒ‡æ•°é€€é¿ç­–ç•¥ï¼Œæé«˜æˆåŠŸç‡åˆ°99.5%+                   â”‚
â”‚  â€¢ å¥åº·æ£€æŸ¥: å®æ—¶ç›‘æ§APIçŠ¶æ€ï¼Œè‡ªåŠ¨æ•…éšœè½¬ç§»                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **2. ç¼“å­˜ç­–ç•¥**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¤šå±‚ç¼“å­˜æ¶æ„                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  L1: å†…å­˜ç¼“å­˜ (MemoryCache)                                    â”‚
â”‚      â€¢ ä»£å¸ä»·æ ¼: 10åˆ†é’ŸTTL                                      â”‚
â”‚      â€¢ åŒºå—èŒƒå›´: 1å°æ—¶TTL                                       â”‚
â”‚      â€¢ é’±åŒ…ä½™é¢: 5åˆ†é’ŸTTL                                       â”‚
â”‚                              â†“                                  â”‚
â”‚  L2: æµè§ˆå™¨ç¼“å­˜ (localStorage)                                 â”‚
â”‚      â€¢ ç”¨æˆ·é…ç½®: æ°¸ä¹…å­˜å‚¨                                       â”‚
â”‚      â€¢ æŸ¥è¯¢å†å²: 7å¤©TTL                                        â”‚
â”‚                              â†“                                  â”‚
â”‚  L3: APIå“åº”ç¼“å­˜                                               â”‚
â”‚      â€¢ äº¤æ˜“æ•°æ®: 30åˆ†é’ŸTTL                                      â”‚
â”‚      â€¢ å†å²æ•°æ®: 24å°æ—¶TTL                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **3. å‰ç«¯æ€§èƒ½ä¼˜åŒ–**

- **Reactä¼˜åŒ–**: ä½¿ç”¨React.memoã€useMemoã€useCallbackå‡å°‘é‡æ¸²æŸ“
- **ä»£ç åˆ†å‰²**: æŒ‰è·¯ç”±å’ŒåŠŸèƒ½æ¨¡å—è¿›è¡Œä»£ç åˆ†å‰²
- **æ‡’åŠ è½½**: å¤§å‹ç»„ä»¶å’Œå›¾è¡¨åº“æŒ‰éœ€åŠ è½½
- **è™šæ‹Ÿæ»šåŠ¨**: å¤§æ•°æ®åˆ—è¡¨ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨æŠ€æœ¯

## ğŸ”§ å¼€å‘å’Œç»´æŠ¤

### **ä»£ç è´¨é‡ä¿è¯**

- **TypeScript**: 100%ç±»å‹è¦†ç›–ï¼Œç¼–è¯‘æœŸé”™è¯¯æ£€æŸ¥
- **ESLint**: ä»£ç é£æ ¼å’Œè´¨é‡æ£€æŸ¥
- **Prettier**: è‡ªåŠ¨ä»£ç æ ¼å¼åŒ–
- **Git Hooks**: æäº¤å‰è‡ªåŠ¨æ£€æŸ¥å’Œæ ¼å¼åŒ–

### **ç›‘æ§å’Œæ—¥å¿—**

- **ç»“æ„åŒ–æ—¥å¿—**: åˆ†çº§æ—¥å¿—è®°å½•ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥
- **æ€§èƒ½ç›‘æ§**: APIå“åº”æ—¶é—´ã€æˆåŠŸç‡å®æ—¶ç›‘æ§
- **é”™è¯¯è¿½è¸ª**: å®Œæ•´çš„é”™è¯¯å †æ ˆå’Œä¸Šä¸‹æ–‡ä¿¡æ¯
- **ç”¨æˆ·è¡Œä¸º**: å…³é”®æ“ä½œçš„ç”¨æˆ·è¡Œä¸ºè¿½è¸ª

---

## ğŸ“ˆ æ¶æ„ä¼˜åŠ¿æ€»ç»“

### **ğŸŒŸ Webç®¡ç†ç•Œé¢æ¶æ„ä¼˜åŠ¿**

1. **ğŸ“Š ä¸“æ³¨æ•°æ®å±•ç¤º**: å‰ç«¯ä¸“æ³¨äºç”¨æˆ·ä½“éªŒå’Œæ•°æ®å¯è§†åŒ–
2. **ğŸ› ï¸ ä¾¿æ·ç®¡ç†**: å†…ç½®Webç®¡ç†ç•Œé¢ï¼Œéšæ—¶éšåœ°ç®¡ç†æ•°æ®
3. **ğŸ”’ æ•°æ®å®‰å…¨**: å®Œæ•´çš„æ•°æ®éªŒè¯ã€äº’æ–¥çº¦æŸæ£€æŸ¥å’Œç®¡ç†å‘˜æƒé™ä¿æŠ¤
4. **âš¡ æ¶æ„ç»Ÿä¸€**: ç»Ÿä¸€çš„APIæ¶æ„ï¼Œæœ€å°åŒ–ä»£ç å¤æ‚åº¦
5. **ğŸš€ ç”¨æˆ·å‹å¥½**: å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒæ‰‹æœºå’Œç”µè„‘è®¿é—®
6. **ğŸ”§ æ˜“äºç»´æŠ¤**: åŸºäºæˆç†Ÿçš„UIç»„ä»¶åº“ï¼Œç»´æŠ¤æˆæœ¬ä½

### **ğŸ‰ å¼€å‘ä½“éªŒä¼˜åŒ–**

- **ğŸ“± éšæ—¶ç®¡ç†**: éƒ¨ç½²åå¯éšæ—¶éšåœ°é€šè¿‡Webç•Œé¢ç®¡ç†æ•°æ®
- **ğŸ”§ ç»´æŠ¤ç®€å•**: åŸºäºshadcn/uiç»„ä»¶åº“ï¼Œä»£ç ç®€æ´æ˜“ç»´æŠ¤
- **âš¡ å¼€å‘æ•ˆç‡**: ç»Ÿä¸€çš„æŠ€æœ¯æ ˆï¼Œæå‡å¼€å‘æ•ˆç‡
- **ğŸ›¡ï¸ æ•°æ®å®‰å…¨**: å®Œæ•´çš„æ•°æ®éªŒè¯å’Œç®¡ç†å‘˜æƒé™ä¿æŠ¤
- **ğŸ¯ ç”¨æˆ·ä½“éªŒ**: ä¸“ä¸šçš„ç®¡ç†ç•Œé¢ï¼Œæ“ä½œç›´è§‚å‹å¥½

### **ğŸ† æ¶æ„åˆ›æ–°ä»·å€¼**

è¿™ä¸ª **Webç®¡ç†ç•Œé¢æ¶æ„** ä¸º BN Alpha Tool å¸¦æ¥äº†æ˜¾è‘—çš„æŠ€æœ¯ä¼˜åŠ¿ï¼š
- âœ… **ä¾¿æ·é«˜æ•ˆ**: éšæ—¶éšåœ°ç®¡ç†æ•°æ®ï¼Œæå‡ç®¡ç†æ•ˆç‡
- âœ… **å®‰å…¨å¯é **: å®Œæ•´çš„æƒé™ä¿æŠ¤å’Œæ•°æ®éªŒè¯æœºåˆ¶
- âœ… **æ˜“äºæ‰©å±•**: åŸºäºæ ‡å‡†çš„WebæŠ€æœ¯ï¼Œæ˜“äºæ‰©å±•åŠŸèƒ½
- âœ… **ç”¨æˆ·å‹å¥½**: ä¸“ä¸šçš„ç•Œé¢è®¾è®¡ï¼Œé™ä½ä½¿ç”¨é—¨æ§›

---

## ğŸ”§ Vercel éƒ¨ç½²ç¯å¢ƒæ•°æ®åˆ·æ–°è§£å†³æ–¹æ¡ˆ

### é—®é¢˜èƒŒæ™¯

åœ¨å°†é¡¹ç›®ä»å›ºå®šJSONæ–‡ä»¶æ•°æ®æºè¿ç§»åˆ°Supabaseæ•°æ®åº“åï¼Œå‘ç°éƒ¨ç½²åœ¨Vercelä¸Šçš„ç½‘ç«™å­˜åœ¨æ•°æ®åˆ·æ–°é—®é¢˜ï¼š
- æ•°æ®åº“æ›´æ–°åï¼Œç‚¹å‡»åˆ·æ–°æŒ‰é’®æˆ–åˆ·æ–°ç½‘é¡µæ— æ³•è·å–æœ€æ–°æ•°æ®
- æœ¬åœ°å¼€å‘ç¯å¢ƒæ­£å¸¸ï¼Œä»…åœ¨Vercelç”Ÿäº§ç¯å¢ƒå‡ºç°æ­¤é—®é¢˜

### æ ¹æœ¬åŸå› 

**Vercelçš„å¤šå±‚ç¼“å­˜æœºåˆ¶**ï¼š
1. **Edge Cache (CDNå±‚)**ï¼šVercelçš„å…¨çƒCDNç¼“å­˜
2. **Function Cache (Serverlesså‡½æ•°å±‚)**ï¼šNext.js APIè·¯ç”±ç¼“å­˜
3. **Browser Cache (æµè§ˆå™¨å±‚)**ï¼šå®¢æˆ·ç«¯æµè§ˆå™¨ç¼“å­˜

### æœ€ä¼˜è§£å†³æ–¹æ¡ˆ

#### 1. ç»Ÿä¸€APIè·¯ç”±è®¾è®¡
**æ–‡ä»¶**: `app/api/airdrop/route.ts`

```typescript
// æ”¯æŒGETå’ŒPOSTä¸¤ç§æ–¹æ³•çš„ç»Ÿä¸€API
export async function GET(request: NextRequest) {
  // æ­£å¸¸æ•°æ®è·å–ï¼Œä¼˜é›…ç¼“å­˜æ§åˆ¶
  response.headers.set('Cache-Control', 'no-store, max-age=0')
  response.headers.set('CDN-Cache-Control', 'no-store')
  response.headers.set('Vercel-CDN-Cache-Control', 'no-store')
}

export async function POST(request: NextRequest) {
  // å¼ºåˆ¶åˆ·æ–°æ•°æ®è·å–ï¼Œç»•è¿‡æ‰€æœ‰ç¼“å­˜
}
```

#### 2. Next.jsé…ç½®ä¼˜åŒ–
**æ–‡ä»¶**: `next.config.mjs`

```javascript
experimental: {
  isrMemoryCacheSize: 0, // ç¦ç”¨ISRå†…å­˜ç¼“å­˜
}
```

#### 3. Verceléƒ¨ç½²é…ç½®
**æ–‡ä»¶**: `vercel.json`

```json
{
  "functions": {
    "app/api/airdrop/route.ts": {
      "maxDuration": 10
    }
  },
  "headers": [
    {
      "source": "/api/airdrop",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "no-store, max-age=0"
        },
        {
          "key": "CDN-Cache-Control",
          "value": "no-store"
        },
        {
          "key": "Vercel-CDN-Cache-Control",
          "value": "no-store"
        }
      ]
    }
  ]
}
```

#### 4. å‰ç«¯è¯·æ±‚ä¼˜åŒ–
**æ–‡ä»¶**: `components/airdrop/airdrop-history.tsx`

```typescript
const loadAirdropData = useCallback(async (forceRefresh = false) => {
  const timestamp = Date.now()
  const method = forceRefresh ? 'POST' : 'GET'
  const url = `/api/airdrop?t=${timestamp}`

  const response = await fetch(url, {
    method,
    cache: 'no-store',
    headers: {
      'Content-Type': 'application/json',
      'Cache-Control': 'no-store',
      'X-Cache-Bust': timestamp.toString(),
      'X-Timestamp': timestamp.toString()
    }
  })
}, [])
```

### æŠ€æœ¯ä¼˜åŠ¿

1. **æ¶æ„ç®€æ´æ€§**ï¼šåˆ é™¤å†—ä½™APIè·¯ç”±ï¼Œç»Ÿä¸€è®¾è®¡æ¨¡å¼
2. **ç¼“å­˜æ§åˆ¶ç²¾å‡†æ€§**ï¼šé’ˆå¯¹Vercelå¹³å°çš„ä¸“ç”¨ä¼˜åŒ–
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šæ­£å¸¸è®¿é—®ä½¿ç”¨GETï¼Œå¼ºåˆ¶åˆ·æ–°ä½¿ç”¨POST
4. **å¯ç»´æŠ¤æ€§**ï¼šæ¸…æ™°çš„ä»£ç ç»“æ„ï¼Œç»Ÿä¸€çš„é”™è¯¯å¤„ç†

### æœ€ä½³å®è·µ

1. **é’ˆå¯¹å¹³å°ä¼˜åŒ–**ï¼šä½¿ç”¨å¹³å°ä¸“ç”¨çš„ç¼“å­˜æ§åˆ¶å¤´
2. **åˆ†å±‚ç¼“å­˜ç­–ç•¥**ï¼šåŒºåˆ†æ­£å¸¸è®¿é—®å’Œå¼ºåˆ¶åˆ·æ–°åœºæ™¯
3. **é…ç½®é›†ä¸­ç®¡ç†**ï¼šåœ¨vercel.jsonä¸­ç»Ÿä¸€é…ç½®ç¼“å­˜ç­–ç•¥
4. **ä»£ç ç®€æ´æ€§**ï¼šé¿å…è¿‡åº¦å¤æ‚çš„ç¼“å­˜æ§åˆ¶é€»è¾‘

è¿™ä¸ªè§£å†³æ–¹æ¡ˆä»æ ¹æœ¬ä¸Šè§£å†³äº†Vercelç¯å¢ƒä¸‹çš„æ•°æ®åˆ·æ–°é—®é¢˜ï¼ŒåŒæ—¶ä¿æŒäº†ä»£ç çš„ç®€æ´æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚